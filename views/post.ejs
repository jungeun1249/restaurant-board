<h2 class="mt-4 mb-4">
  <%= post.title %>
</h2>

<p class="mb-2">
  평점:
  <%= '★'.repeat(post.rating) %><%= '☆'.repeat(5 - post.rating) %>
  (<%= post.rating %>점)
</p>

<p class="text-muted">
  작성자: <%= post.username %> | 작성일: <%= post.createdAt %>
</p>

<% if (post.image) { %>
  <div class="mb-3">
    <img src="/uploads/<%= post.image %>" alt="첨부된 이미지" class="img-fluid rounded border">
  </div>
<% } %>

<div class="mb-4">
  <p>
    <%- post.content.replace(/\n/g, '<br>') %>
  </p>
</div>

<% if (post.lat && post.lng) { %>
  <div class="mb-4">
    <label class="form-label">위치</label>
    <div id="postMap" style="width:100%; height:250px; border:1px solid #ccc;"></div>
    <small class="text-muted">
      위도, 경도: <%= post.lat %>, <%= post.lng %>
    </small>
  </div>

  <script>
    (function () {
      if (!window.kakao || !kakao.maps) return;
      var container = document.getElementById('postMap');
      if (!container) return;

      var lat = <%= post.lat %>;
      var lng = <%= post.lng %>;

      var options = {
        center: new kakao.maps.LatLng(lat, lng),
        level: 3
      };

      var map = new kakao.maps.Map(container, options);
      var marker = new kakao.maps.Marker({
        position: new kakao.maps.LatLng(lat, lng)
      });
      marker.setMap(map);
    })();
  </script>
<% } %>

<% if (session.userId === post.userId) { %>
  <a href="/edit/<%= post.id %>" class="btn btn-sm btn-warning">수정</a>
  <form method="POST" action="/delete/<%= post.id %>?_method=DELETE" class="d-inline">
    <button class="btn btn-sm btn-danger">삭제</button>
  </form>
<% } %>

<hr>

<h5 class="mt-5">댓글</h5>

<form method="POST" action="/post/<%= post.id %>/comments" class="mb-4">
  <div class="mb-3">
    <textarea class="form-control" name="comment" rows="3" placeholder="댓글 작성" required></textarea>
  </div>
  <button class="btn btn-primary">댓글 등록</button>
</form>

<ul class="list-group">
  <% comments.forEach(function(comment) { %>
    <li class="list-group-item">
      <div class="mb-1">
        <strong><%= comment.username %></strong>
        | <small class="text-muted"><%= comment.createdAt %></small>
      </div>
      <div>
        <%= comment.content %>
      </div>
      <% if (session.userId === comment.userId) { %>
        <div class="mt-2">
          <a href="/comments/<%= comment.id %>/edit" class="btn btn-sm btn-outline-secondary">수정</a>
          <form method="POST" action="/comments/<%= comment.id %>?_method=DELETE" class="d-inline">
            <button class="btn btn-sm btn-outline-danger">삭제</button>
          </form>
        </div>
      <% } %>
    </li>
  <% }); %>
</ul>
