<h2>글 작성</h2>

<form method="POST" action="/write" enctype="multipart/form-data">
  <div class="mb-3">
    <label class="form-label">제목</label>
    <input type="text" class="form-control" name="title" required>
  </div>
  <div class="mb-3">
    <label class="form-label">내용</label>
    <textarea class="form-control" name="content" rows="5" required></textarea>
  </div>
  <div class="mb-3">
    <label for="rating" class="form-label">별점</label>
    <select id="rating" name="rating" class="form-select" required>
      <option value="" disabled selected>별점을 선택하세요</option>
      <% for (let i = 5; i >= 1; i--) { %>
        <option value="<%= i %>">
          <%= '★'.repeat(i) %><%= '☆'.repeat(5 - i) %> (<%= i %>점)
        </option>
      <% } %>
    </select>
  </div>

  <!-- 위치 선택 -->
  <div class="mb-3">
    <label class="form-label">위치 선택 (지도를 클릭하세요)</label>
    <div id="writeMap" style="width:100%; height:250px; border:1px solid #ccc;"></div>
    <input type="hidden" name="lat" id="lat">
    <input type="hidden" name="lng" id="lng">
    <small class="text-muted" id="coordText">위도, 경도: 선택 안 됨</small>
  </div>

  <div class="mb-3">
    <label class="form-label">이미지 업로드</label>
    <input type="file" class="form-control" name="image" accept="image/*">
  </div>
  <button type="submit" class="btn btn-success">작성</button>
</form>

<script>
  // 페이지가 다 로드된 뒤에 실행
  window.addEventListener('load', function () {
    var writeMapContainer = document.getElementById('writeMap');
    if (!writeMapContainer) return;

    // 카카오 지도 SDK가 로드되지 않은 경우
    if (!(window.kakao && kakao.maps)) {
      console.error('카카오 지도 SDK 로드 실패');
      writeMapContainer.innerHTML = '지도를 불러오지 못했습니다.';
      return;
    }

    var writeMapOption = {
      center: new kakao.maps.LatLng(37.5665, 126.9780), // 서울
      level: 5
    };

    var writeMap = new kakao.maps.Map(writeMapContainer, writeMapOption);
    var writeMarker = new kakao.maps.Marker();
    writeMarker.setMap(null);

    kakao.maps.event.addListener(writeMap, 'click', function (mouseEvent) {
      var latlng = mouseEvent.latLng;

      writeMarker.setPosition(latlng);
      writeMarker.setMap(writeMap);

      var lat = latlng.getLat();
      var lng = latlng.getLng();

      document.getElementById('lat').value = lat;
      document.getElementById('lng').value = lng;
      document.getElementById('coordText').innerText =
        '위도, 경도: ' + lat.toFixed(6) + ', ' + lng.toFixed(6);
    });
  });
</script>
